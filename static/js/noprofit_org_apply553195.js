var basetool=$.fn.basetool,nav=$.fn.nav,adapt_helper=$.fn.adapt_helper;function doSubmit(r){r&&($(".js_apply_submit").hasClass("noprofit_org_btn_disable")||($(".js_apply_submit").removeClass("dealer_add_form_submit_change").addClass("noprofit_org_btn_disable"),$.ajax({url:"/cgi-bin/bizmail_portal",type:"POST",dataType:"json",data:{resp_charset:"UTF8",action:"non_profite_apply",corpid:$.trim($("input[name=corpid]").val()),domain:$.trim($("input[name=domain]").val()),orgName:$.trim($("input[name='org_name']").val()),orgCode:$.trim($("input[name='org_code']").val()),orgPrincipal:$.trim($("input[name='org_principal']").val()),tel:$.trim($("input[name='tel']").val()),pre_owner_alias:$.trim($("input[name='free_account']").val()),apply_owner_quota:$.trim($("input[name='account_num']").val()),orgCodeImage:$("input[name='orgCodeImage']").val(),domain_img:$("input[name='domain_img']").val(),cus_url:$("input[name='link']").val(),otherImage:$("input[name='otherImage']").val(),t:"biz_rf_portal_mgr",ef:"jsnew"},success:function(r){0==r.data.errorcode?((new Image).src="/cgi-bin/sellonlinestatic?type=nosession_statistics&businame=noprofit_org_apply&item=applySucc&r="+Math.random(),$(".noprofit_org_condition").hide(),$(".dealer_add_form").hide(),$(".dealer_form_suc").show()):"-99"==r.data.errorcode?$.fn.basetool.showErr("\u7ec4\u7ec7\u673a\u6784\u4ee3\u7801\u8bc1\u7684\u56fe\u7247\u7c7b\u578b\u9519\u8bef"):"-98"==r.data.errorcode?$.fn.basetool.showErr("\u7ec4\u7ec7\u673a\u6784\u4ee3\u7801\u8bc1\u7684\u56fe\u7247\u8d85\u8fc75M"):"-97"==r.data.errorcode?$.fn.basetool.showErr("\u4fdd\u5b58\u7ec4\u7ec7\u673a\u6784\u4ee3\u7801\u8bc1\u5931\u8d25"):"-96"==r.data.errorcode?$.fn.basetool.showErr("\u5176\u4ed6\u8bc1\u660e\u6750\u6599\u56fe\u7247\u7c7b\u578b\u9519\u8bef"):"-95"==r.data.errorcode?$.fn.basetool.showErr("\u5176\u4ed6\u8bc1\u660e\u6750\u6599\u7684\u56fe\u7247\u8d85\u8fc75M"):"-94"==r.data.errorcode?$.fn.basetool.showErr("\u4fdd\u5b58\u5176\u4ed6\u8bc1\u660e\u6750\u6599\u5931\u8d25"):"-102"==r.data.errorcode?$.fn.basetool.showErr("\u7533\u8bf7\u5931\u8d25"):"-103"==r.data.errorcode?$.fn.basetool.showErr("\u8bf7\u586b\u5199\u6709\u6548\u7684\u57fa\u7840\u7248\u4f01\u4e1aID"):"-104"==r.data.errorcode?$.fn.basetool.showErr("\u8be5\u516c\u76ca\u7ec4\u7ec7\u5df2\u7ecf\u7533\u8bf7\u516c\u76ca\u8ba1\u5212\uff0c\u5e76\u5df2\u6210\u529f\u5f00\u901a\u6536\u8d39\u7248\u90ae\u7bb1"):"-105"==r.data.errorcode?$.fn.basetool.showErr("\u8be5\u7ec4\u7ec7\u4ee3\u7801\u5df2\u7ecf\u7533\u8bf7\u516c\u76ca\u8ba1\u5212\uff0c\u5e76\u5df2\u6210\u529f\u5f00\u901a\u6536\u8d39\u7248\u90ae\u7bb1"):"-106"==r.data.errorcode?$.fn.basetool.showErr("\u8be5\u514d\u8d39\u7248\u5e10\u53f7\u5df2\u7ecf\u7533\u8bf7\u516c\u76ca\u8ba1\u5212\uff0c\u5e76\u5df2\u6210\u529f\u5f00\u901a\u6536\u8d39\u7248\u90ae\u7bb1"):"-107"==r.data.errorcode?$.fn.basetool.showErr("\u8bf7\u586b\u5199\u6709\u6548\u7684\u4f01\u4e1a\u57df\u540d"):"-108"==r.data.errorcode?$.fn.basetool.showErr("\u8bf7\u586b\u5199\u6709\u6548\u7684\u624b\u673a\u53f7"):"-109"==r.data.errorcode?$.fn.basetool.showErr("\u5f53\u524d\u6682\u672a\u5f00\u901a\u57fa\u7840\u7248\u4f01\u4e1a\u90ae"):"-115"==r.data.errorcode?$.fn.basetool.showErr("\u7533\u8bf7\u64cd\u4f5c\u592a\u9891\u7e41\uff0c\u8bf7\u4e8e1\u5c0f\u65f6\u540e\u518d\u8fdb\u884c\u64cd\u4f5c"):$.fn.basetool.showErr("\u7533\u8bf7\u5931\u8d25"),$(".js_apply_submit").removeClass("noprofit_org_btn_disable").addClass("dealer_add_form_submit_change")},error:function(r){}})))}function htmlDecode(r){return r&&r.replace?r.replace(/&nbsp;/gi," ").replace(/&lt;/gi,"<").replace(/&gt;/gi,">").replace(/&amp;/gi,"&").replace(/&quot;/gi,'"').replace(/&#39;/gi,"'"):r}function validInput(){var r=$.trim($("input[name='account_num']").val());return""==$.trim($("input[name='corpid']").val())?($.fn.basetool.showErr("\u8bf7\u586b\u5199\u4f01\u4e1aID"),!1):""==$.trim($("input[name='domain']").val())?($.fn.basetool.showErr("\u8bf7\u586b\u5199\u4f01\u4e1a\u57df\u540d"),!1):validNum(r)&&""!=r?""==$.trim($("input[name='org_name']").val())?($.fn.basetool.showErr("\u8bf7\u586b\u5199\u516c\u76ca\u7ec4\u7ec7\u540d\u79f0"),!1):""==$.trim($("input[name='org_code']").val())?($.fn.basetool.showErr("\u8bf7\u586b\u5199\u7ec4\u7ec7\u673a\u6784\u4ee3\u7801"),!1):""==$.trim($("input[name='org_principal']").val())?($.fn.basetool.showErr("\u8bf7\u586b\u5199\u6cd5\u5b9a\u4ee3\u8868\u4eba"),!1):""==$.trim($("input[name='tel']").val())?($.fn.basetool.showErr("\u8bf7\u586b\u5199\u624b\u673a\u53f7"),!1):validAccLimit($("input[name='account_num']").val())?($.fn.basetool.showErr("\u6700\u591a\u53ea\u80fd\u7533\u8bf71000\u5e10\u53f7\u6570"),!1):validPhone($.trim($("input[name='tel']").val()))?validNum($.trim($("input[name='account_num']").val()))?""==$("input[name='domain_img']").val()?($.fn.basetool.showErr("\u8bf7\u4e0a\u4f20\u57df\u540d\u6240\u6709\u8005\u8bc1\u4e66"),!1):""!=$("input[name='orgCodeImage']").val()||($.fn.basetool.showErr("\u8bf7\u4e0a\u4f20\u7ec4\u7ec7\u673a\u6784\u4ee3\u7801\u8bc1"),!1):($.fn.basetool.showErr("\u8bf7\u586b\u5199\u6b63\u786e\u7684\u5e10\u53f7\u6570"),!1):($.fn.basetool.showErr("\u8bf7\u586b\u5199\u6b63\u786e\u7684\u624b\u673a\u53f7"),!1):($.fn.basetool.showErr("\u8bf7\u7533\u8bf7\u7684VIP\u5e10\u53f7\u6570"),!1)}function validPhone(r){if(0==r.length)return!0;return/^(\+86)?(1)+\d{10}$/.test(r)}function validNum(r){if(0==r.length)return!0;return/^[1-9]\d*$/.test(r)}function validAccLimit(r){return 0!=r.length&&!!(1e3<parseInt(r,10))}function validLink(r){if(0==r.length)return!0;return/^((https|http|ftp|rtsp|mms)?:\/\/)[^\s]+/.test(r)}function checkAccountNum(t){var r=$.trim($("input[name='free_account']").val()),o=$.trim($("input[name='account_num']").val());r&&o&&$.ajax({url:"/cgi-bin/bizmail_portal",type:"POST",dataType:"json",data:{resp_charset:"UTF8",action:"validate_apply_quota",pre_owner_alias:r,apply_owner_quota:o,t:"biz_rf_portal_mgr",ef:"jsnew"},success:function(r){0==r.data.errorcode?t&&t(!0):"-101"==r.data.errorcode?($.fn.basetool.showErr("\u586b\u5199\u7684\u5e10\u53f7\u6570\u4e0d\u80fd\u5c0f\u4e8e\u539f\u6765\u5f00\u901a\u7684\u5e10\u53f7\u6570"),t&&t(!1)):"-100"==r.data.errorcode?($.fn.basetool.showErr("\u8bf7\u586b\u5199\u6b63\u786e\u7684\u514d\u8d39\u7248\u5e10\u53f7"),t&&t(!1)):t&&t(!0)},error:function(){t&&t(!0)}})}adapt_helper.adaptHeader(),adapt_helper.adaptBodyWidth(),(new Image).src="/cgi-bin/sellonlinestatic?type=nosession_statistics&businame=noprofit_org_apply&item=applyEnterClick&r="+Math.random(),$(".js_apply_submit").click(function(r){r.preventDefault(),validInput()&&doSubmit(!0)}),$(document).on("blur","input[name='link']",function(r){return validLink(this.value)?($(r.target).parents("div.noprofit_org_form_item_right").find(".error").hide(),!0):($(r.target).parents("div.noprofit_org_form_item_right").find(".error").show(),!1)}),$(document).on("blur","input[name='tel']",function(r){return validPhone(this.value)?($(r.target).parents("div.noprofit_org_form_item_right").find(".error").hide(),!0):($(r.target).parents("div.noprofit_org_form_item_right").find(".error").show(),!1)}),$(document).on("blur","input[name='account_num']",function(r){return validNum(this.value)?($(r.target).parents("div.noprofit_org_form_item_right").find(".error").hide(),checkAccountNum(),!0):($(r.target).parents("div.noprofit_org_form_item_right").find(".error").show(),!1)}),$(document).on("keyup","input[name='account_num']",function(r){if(validAccLimit(this.value))return $.fn.basetool.showErr("\u6700\u591a\u53ea\u80fd\u7533\u8bf71000\u5e10\u53f7\u6570"),!1}),$(document).on("focus","input[type='text']",function(r){$(r.target).parents("div.noprofit_org_form_item_right").find(".error").hide()}),$(document).on("click",".icon_x_div",function(r){var t=$(r.target);t.parents("div.noprofit_org_form_item_right").find(".previewImg").attr("src",""),t.parents("div.noprofit_org_form_item_right").find(".imgPreviewContainer").removeClass("imgPreviewContainerAfter").hide(),t.parents("div.noprofit_org_form_item_right").removeClass("item_right_after_height"),t.parents("div.noprofit_org_form_item_right").find(".uploadCtr").show(),t.parents("div.noprofit_org_form_item_right").find(".js_ajax_img").val("")}),$(document).on("change","input.js_upload_btn",function(r){var t=$(r.target).val().split("/").pop().split("\\").pop().split(".").pop(),e=$(r.target);if(e.parents("form").find(".error").text("").hide(),e.parents("form").find(".error").text(""),"jpg"!=t&&"jpeg"!=t&&"png"!=t&&"bmp"!=t&&"gif"!=t)return e.parents("form").find(".error").text("\u4e0d\u652f\u6301\u8be5\u683c\u5f0f\u7684\u56fe\u7247").show(),!1;e.parents("form").submit(),this.value="",$.fn.basetool.showTipsTop(!0,"\u4e0a\u4f20\u4e2d..."),setTimeout(function(){var o=setInterval(function(){e.parents("form");var r=e.parents("div.noprofit_org_form_item_right").find("iframe");if(r&&r[0]&&r[0].contentWindow&&r[0].contentWindow.document&&r[0].contentWindow.document.body.innerHTML){var t=JSON.parse(r[0].contentWindow.document.body.innerHTML);if(5242880<parseInt(t.data.filesize,10))return e.parents("form").find(".error").text("\u56fe\u7247\u5927\u5c0f\u8d85\u51fa5M").show(),clearInterval(o),$.fn.basetool.showTipsTop(!1),!1;if(t.data.errorcode&&"-115"==t.data.errorcode)return $.fn.basetool.showTipsTop(!1),$.fn.basetool.showErr("\u4e0a\u4f20\u64cd\u4f5c\u592a\u9891\u7e41\uff0c\u8bf7\u4e8e1\u5c0f\u65f6\u540e\u518d\u8fdb\u884c\u64cd\u4f5c"),clearInterval(o),!1;$("label[for="+e.attr("id")+"]").text("\u91cd\u65b0\u4e0a\u4f20"),e.parents("div.noprofit_org_form_item_right").find(".previewImg").attr("src",htmlDecode(t.data.viewfileurl)),e.parents("div.noprofit_org_form_item_right").find(".imgPreviewContainer").addClass("imgPreviewContainerAfter").show(),e.parents("div.noprofit_org_form_item_right").addClass("item_right_after_height"),e.parents("div.noprofit_org_form_item_right").find(".js_ajax_img").val(0<=t.data.filename.indexOf("/")?t.data.filename.split("/").pop():t.data.filename),clearInterval(o),$.fn.basetool.showTipsTop(!1)}},500)},1e3)}),$(function(){var r=$("#corp_id_tips");r.click(function(){r.hide()}),$("body").on("click","#tips_icon",function(){r.show()})});